<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="//maps.google.com/maps/api/js?v=3.18&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script> 
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<br />

<div class="booyah-box col-xs-10 col-xs-offset-1">
  <% totaldistance = 0 %>
  <% convert_totaldistance = 0 %>
  <% @walks.each do |walk| %>
    <% totaldistance = walk.step * @current_user_setting.step_conversion * @current_user_setting.distance_conversion+ totaldistance %>
  <% end %> 
  <% if @current_user_setting.distanceunit == 1 %>
    <% convert_totaldistance = totaldistance * 1609.34 %>
  <% else %>
    <% convert_totaldistance = totaldistance * 1000 %>  
  <% end %>

  <br />

  <% @current_lat  = @latlngdata[0][:lat]%>
  <% @current_long = @latlngdata[0][:long]%>
  <% @latlngdata.each do |point| %>
    <% if point[:dist] > convert_totaldistance %>
      <% @current_lat = point[:lat] %>
      <% @current_long = point[:long] %>
      <% break %>
    <% end %>
  <% end %>

  <div id="foo" data-lat="<%= @current_lat%>"</div>
  <div id="foo1" data-long="<%= @current_long%>"</div>

  <div style='width: 800px;'>
    <div id="map" style='width: 800px; height: 400px;'></div>
  </div>

  <script type="text/javascript">
    
    // curr_lat and curr_long are close to current location.
    //var curr_lat = $("#curr_lat").data("currlat");
    //var curr_long = $("#curr_long").data("currlong");
    var lat1 = $("#foo").data("lat");
    var long1 = $("#foo1").data("long");

    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {
      //zoom: 50,
      //center: new google.maps.LatLng(41.83326,-87.77535),
      //mapTypeId: google.maps.MapTypeId.ROADMAP
      //styles: mapStyle
    }, internal: {id: 'map'}}, function(){

    markers = handler.addMarkers([
    {
      //"lat": 41.83326,
      //"lng": -87.77535
      "lat": lat1,
      "lng": long1
    }
    ]);

    var kmls = handler.addKml(
       {url: "https://raw.githubusercontent.com/hkawanishi/route-sixty-six/master/app/assets/kml/route66_start1.kml"}
    );
   
    handler.bounds.extendWith(markers);
    handler.getMap().setZoom(15)
    //handler.fitMapToBounds();
    });
    
    
</script>

</div>
<br /><br />
<%= link_to 'Enter Daily Steps', new_walker_walk_path, :class => 'btn btn-primary' %>
<br /><br />
<!--%= link_to 'Map', @map_html, :class => 'btn btn-primary' %-->

<div id="total_distance">
  <h3>Total Distance : <%= totaldistance.round(2) %>
    <% if @current_user_setting.distanceunit == 1 %>
      Miles
    <% else %>
      Km
    <% end %>
  </h3>
</div>
  <br /><br />
  <div class="CSSTableGenerator" >
      <table >
          <tr>
              <td>
                  Date
              </td>
              <td >
                  Steps
              </td>
              <td>
                  <% if @current_user_setting.strideunit == 1 %>
                    Distance (Miles)
                  <% else %>
                    Distance (Km)
                  <% end %>
              </td>
          </tr>
          <% @walks.reverse_each do |walk| %>
            <% walk.distance = walk.step * @current_user_setting.step_conversion * @current_user_setting.distance_conversion  %>
            <tr>
                <td >
                    <%= walk.date %>
                </td>
                <td>
                    <%= walk.step %>
                </td>
                <td>
                    <%= walk.distance.round(2) %>
                </td>
            </tr>
          <% end %>
      </table>

</div>
